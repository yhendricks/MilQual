{% extends 'base.html' %}

{% block title %}Dashboard - MilQual{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <h1>Quality Tracking Dashboard</h1>
        <p class="lead">Track PCBs and modules through the testing workflow</p>
    </div>
</div>

{% if batches %}
<div class="row mt-4">
    <div class="col-md-12">
        <h3>Batch Overview</h3>
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>Batch Number</th>
                        <th>PCB Type</th>
                        <th>Description</th>
                        <th>PCBs Count</th>
                        <th>Production Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for batch in batches %}
                    <tr>
                        <td>{{ batch.batch_number }}</td>
                        <td>{{ batch.pcb_type.name }}</td>
                        <td>{{ batch.description|default:"No description" }}</td>
                        <td>{{ batch.pcbs.count }}</td>
                        <td>{{ batch.production_date|date:"M d, Y H:i" }}</td>
                        <td>
                            <a href="{% url 'pcb_create' %}" class="btn btn-sm btn-primary">Add PCBs</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endif %}

{% if can_view_summary %}
<div class="row mt-4">
    <div class="col-md-12">
        <h3>Production Summary</h3>
        <div class="table-responsive">
            <table class="table table-bordered">
                <thead class="table-light">
                    <tr>
                        <th>Metric</th>
                        <th>Count</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Total PCBs</td>
                        <td>{{ pcb_count }}</td>
                    </tr>
                    <tr>
                        <td>Pending Tests</td>
                        <td>{{ pcb_pending }}</td>
                    </tr>
                    <tr>
                        <td>Tested PCBs</td>
                        <td>{{ pcb_tested }}</td>
                    </tr>
                    <tr>
                        <td>Verified by QA</td>
                        <td>{{ pcb_qa_verified }}</td>
                    </tr>
                    <tr>
                        <td>Total Modules</td>
                        <td>{{ module_count }}</td>
                    </tr>
                    <tr>
                        <td>Assembled Modules</td>
                        <td>{{ modules_assembled }}</td>
                    </tr>
                    <tr>
                        <td>Functionally Tested</td>
                        <td>{{ modules_functional_tested }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endif %}

<div class="row mt-4">
    <div class="col-md-12">
        <h3>Quick Actions</h3>
        <div class="btn-group" role="group">
            {% for group in user.groups.all %}
                {% if group.name == 'board_tester_lvl1' or group.name == 'board_tester_lvl2' %}
                    <a href="{% url 'pcb_test' %}" class="btn btn-primary">Test PCB</a>
                {% endif %}
            {% endfor %}
            {% for group in user.groups.all %}
                {% if group.name == 'assembler_lvl1' %}
                    <a href="{% url 'module_assemble' %}" class="btn btn-primary">Assemble Module</a>
                {% endif %}
            {% endfor %}
            {% for group in user.groups.all %}
                {% if 'Function_tester' in group.name or 'Environmental_tester' in group.name %}
                    <a href="{% url 'module_functional_test' %}" class="btn btn-primary">Test Module</a>
                {% endif %}
            {% endfor %}
            {% for group in user.groups.all %}
                {% if 'Manager' in group.name %}
                    <a href="{% url 'module_sign_off' %}" class="btn btn-primary">Sign Off Modules</a>
                    <a href="{% url 'batch_create' %}" class="btn btn-primary">Create Batch</a>
                    <a href="{% url 'pcb_create' %}" class="btn btn-primary">Create PCB</a>
                {% endif %}
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}